# -----------------------------------------------------------------
# ЭТАП 1: СБОРКА ФРОНТЕНДА (BUILDER)
# -----------------------------------------------------------------
FROM node:20-alpine AS builder

# Устанавливаем рабочую директорию
WORKDIR /app

# Копируем файлы зависимостей
COPY ./package.json ./package-lock.json ./

# Устанавливаем зависимости
# Используем флаг --legacy-peer-deps для большей совместимости, если используются старые версии React/других библиотек
RUN npm install --legacy-peer-deps

# Копируем остальной исходный код фронтенда (например, src/)
COPY . .

# Запускаем команду сборки
# Если ваша команда сборки отличается от 'npm run build', замените ее здесь!
# Мы используем команду, предполагающую, что папка сборки называется 'build'.
RUN npm run build

# -----------------------------------------------------------------
# ЭТАП 2: ЗАПУСК NGINX (RUNNER)
# -----------------------------------------------------------------
FROM nginx:stable-alpine

# Копируем скомпилированные статические файлы из этапа 'builder'
# Важно: Замените 'build' на фактическое имя папки, которую создает ваша команда 'npm run build'
COPY --from=builder /app/build /usr/share/nginx/html

# 3. Открываем порт
EXPOSE 80

# 4. Nginx запускается по умолчанию
CMD ["nginx", "-g", "daemon off;"]